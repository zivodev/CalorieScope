<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=5.0, maximum-scale=1.0" />
<title>CalorieScope</title>
<link rel="icon" type="image/png" href="logo.png">
<style>
  :root {
    --control-width: 180px;
    --control-height: 44px;
  }
  body {
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: #111;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }

  .brand {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 16px;
  }
  .brand img { width: 40px; height: 40px; border-radius: 8px; }
  .brand-title { font-size: 24px; font-weight: 800; letter-spacing: 0.5px; }

  .container {
    width: 100%;
    max-width: 400px;
    padding: 20px;
    box-sizing: border-box;
    position: relative;
  }

  #langBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #d3a15d;
    color: #111;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: 700;
    font-size: 16px;
    line-height: 32px;
    text-align: center;
    padding: 0;
    z-index: 1000;
    transition: background 0.3s, transform 0.2s;
  }
  #langBtn:hover { background: #e2b56f; transform: scale(1.1); }

  #loadingBar {
    position: fixed; top: 0; left: 0; height: 4px; width: 0%;
    background: linear-gradient(90deg, #d3a15d, #f0c57a);
    transition: width 0.3s ease; z-index: 2000;
  }
  @keyframes loadingPulse {
    0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; }
  }
  #loadingBar.active { width: 100%; animation: loadingPulse 1s infinite; }

  form {
    display: flex; flex-direction: column; gap: 14px; margin-top: 40px;
  }
  input, select, button {
    width: 100%; padding: 12px; font-size: 16px;
    border-radius: 10px; border: none; box-sizing: border-box;
  }
  input, select { background: #222; color: #fff; }
  button[type="submit"], #sendImage {
    background: #d3a15d; color: #111; font-weight: 600; cursor: pointer; transition: 0.2s;
  }
  button:hover { background: #e2b56f; transform: scale(1.05); }

  #goal, #progressContainer { text-align: center; margin-top: 20px; }
  progress { width: 100%; height: 18px; }

  .manualAdd {
    display: flex; align-items: center; justify-content: center;
    gap: 15px; margin-top: 15px;
  }
  #manualCalories {
    flex: 1; font-size: 20px; padding: 18px; text-align: center;
    border-radius: 12px; background: #222; color: #fff; border: 2px solid #333;
  }
  #addCaloriesBtn {
    background: #d3a15d; color: #111; font-weight: 700;
    width: 55px; height: 55px; border-radius: 50%; border: none;
    cursor: pointer; font-size: 22px; line-height: 55px; text-align: center;
    transition: all 0.2s ease;
  }
  #addCaloriesBtn:hover { background: #e2b56f; transform: scale(1.1); }

  #sendImage {
    width: 55px; height: 55px; border-radius: 50%;
    font-size: 22px; font-weight: 800; line-height: 55px; padding: 0;
  }
  @media (max-width: 480px) {
    #manualCalories { font-size: 18px; padding: 16px; }
    #addCaloriesBtn, #sendImage {
      width: 50px; height: 50px; font-size: 20px; line-height: 50px;
    }
  }
  .actionsColumn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; margin-top: 16px; }
  .uploadRow { display: flex; align-items: center; justify-content: center; gap: 12px; }
  .circleBtn {
    width: 44px; height: 44px; border-radius: 50%;
    display: inline-flex; align-items: center; justify-content: center;
    font-size: 20px; font-weight: 800; padding: 0;
  }
  #mealImage { display: none; }
  #uploadBtn {
    background: #222; color: #fff; border: 2px solid #333;
    cursor: pointer; transition: 0.2s; width: var(--control-width);
    height: var(--control-height); border-radius: 10px;
    display: inline-flex; align-items: center; justify-content: center; font-weight: 600;
  }
  #uploadBtn:hover { background: #2a2a2a; }

  .macroProgress p { margin: 6px 0; font-size: 14px; color: #ddd; }
</style>
</head>
<body>
  <div id="loadingBar"></div>
  <div class="container" dir="ltr">
    <button id="langBtn">ع</button>
    <div class="brand" aria-label="CalorieScope">
      <img src="logo.png" alt="" />
      <span class="brand-title">CalorieScope</span>
    </div>

    <form id="userForm">
      <input type="number" id="age" placeholder="Age" required />
      <input type="number" id="weight" placeholder="Weight (kg)" required />
      <input type="number" id="height" placeholder="Height (cm)" required />

      <select id="gender" required>
        <option value="">Select Gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>

      <select id="activity" required>
        <option value="">Activity Level</option>
        <option value="sedentary">Sedentary (little or no exercise)</option>
        <option value="light">Lightly Active (1–3 days/week)</option>
        <option value="moderate">Moderately Active (3–5 days/week)</option>
        <option value="active">Active (6–7 days/week)</option>
        <option value="very_active">Very Active (hard daily exercise)</option>
      </select>

      <button type="submit">Get Calorie Goal</button>
    </form>

    <div id="goal"></div>

    <div id="progressContainer" style="display:none;">
      <progress id="calorieBar" value="0" max="100"></progress>
      <p id="progressText">0 / 0 kcal</p>

      <!-- ✅ Added macros -->
      <div class="macroProgress">
        <p id="proteinText">Protein: 0g / 0g</p>
        <p id="carbsText">Carbs: 0g / 0g</p>
        <p id="fatText">Fats: 0g / 0g</p>
      </div>

      <div class="actionsColumn">
        <div class="uploadRow">
          <input type="file" id="mealImage" accept="image/*" />
          <button id="uploadBtn" type="button" aria-label="Upload">⬆ Add a photo</button>
          <button id="sendImage" class="circleBtn" type="button" aria-label="Send">➤</button>
        </div>

        <div class="manualAdd">
          <input type="number" id="manualCalories" placeholder="Add calories manually" />
          <button id="addCaloriesBtn" class="circleBtn" type="button">+</button>
        </div>
      </div>
    </div>
  </div>

<script>
let goal = 0, current = 0, lang = "en";

const texts = {
  en: { goalText: "Your daily goal:" },
  ar: { goalText: "هدفك اليومي:" }
};

function showLoading(show) {
  const bar = document.getElementById('loadingBar');
  if (show) bar.classList.add('active'); else bar.classList.remove('active');
}

/* --- Calorie + Macros Logic --- */
document.getElementById('userForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  showLoading(true);

  const data = {
    age: document.getElementById('age').value,
    weight: document.getElementById('weight').value,
    height: document.getElementById('height').value,
    gender: document.getElementById('gender').value,
    activity: document.getElementById('activity').value
  };

  try {
    const res = await fetch('https://zivodev.app.n8n.cloud/webhook/bcddd092-eaa8-4a52-9e24-a1a7e5b26dd6', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const text = await res.text();
    let result; try { result = JSON.parse(text); } catch { result = {}; }

    goal = Number(result.dailyGoal) || 0;
    const proteinGoal = Number(result.proteinGoal) || 0;
    const carbGoal = Number(result.carbGoal) || 0;
    const fatGoal = Number(result.fatGoal) || 0;

    current = 0;
    document.getElementById('goal').textContent = `${texts[lang].goalText} ${goal} kcal`;
    document.getElementById('progressContainer').style.display = 'block';
    document.getElementById('calorieBar').max = Math.max(goal, 1);
    document.getElementById('calorieBar').value = current;
    document.getElementById('progressText').textContent = `${current} / ${goal} kcal`;

    // ✅ update macro targets
    document.getElementById('proteinText').textContent = `Protein: 0g / ${proteinGoal}g`;
    document.getElementById('carbsText').textContent = `Carbs: 0g / ${carbGoal}g`;
    document.getElementById('fatText').textContent = `Fats: 0g / ${fatGoal}g`;

  } catch {
    alert('Error fetching goal.');
  } finally {
    showLoading(false);
  }
});
</script>
</body>
</html>